#import "sdl";

using sdl;

using SDL_EventType;
using SDL_Keycode;
using SDL_WindowEventID;

main :: () -> i32 {
    if SDL_Init(SDL_INIT_VIDEO) != 0 {
        return 1;
    }

    window_title := "Test\0";
    window := SDL_CreateWindow(window_title.pointer, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, 1280, 720, SDL_WINDOW_SHOWN);
    if window == 0 {
        return 1;
    }

    renderer := SDL_CreateRenderer(window, -1, SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC);
    if renderer == 0 {
        return 1;
    }

    x: i32 = 0;
    y: i32 = 0;

    moving_left := false;
    moving_right := false;
    moving_up := false;
    moving_down := false;

    running := true;
    while running {
        event: SDL_Event;

        while SDL_PollEvent(*event) != 0 {
            if event.type == SDL_QUIT {
                running = false;
            } else if event.type == SDL_WINDOWEVENT {
                window_event := event.body.window;

                if window_event.event == SDL_WINDOWEVENT_CLOSE {
                    running = false;
                }
            } else if event.type == SDL_KEYDOWN {
                key_event := event.body.key;

                if key_event.keysym.sym == SDLK_a {
                    moving_left = true;
                } else if key_event.keysym.sym == SDLK_d {
                    moving_right = true;
                } else if key_event.keysym.sym == SDLK_w {
                    moving_up = true;
                } else if key_event.keysym.sym == SDLK_s {
                    moving_down = true;
                }
            } else if event.type == SDL_KEYUP {
                key_event := event.body.key;

                if key_event.keysym.sym == SDLK_a {
                    moving_left = false;
                } else if key_event.keysym.sym == SDLK_d {
                    moving_right = false;
                } else if key_event.keysym.sym == SDLK_w {
                    moving_up = false;
                } else if key_event.keysym.sym == SDLK_s {
                    moving_down = false;
                }
            }
        }

        speed: i32 = 2;

        if moving_left {
            x -= speed;
        }

        if moving_right {
            x += speed;
        }

        if moving_up {
            y -= speed;
        }

        if moving_down {
            y += speed;
        }

        SDL_SetRenderDrawColor(renderer, 0, 0, 0, 0xFF);
        SDL_RenderClear(renderer);

        SDL_SetRenderDrawColor(renderer, 0xFF, 0, 0, 0xFF);
        rect: SDL_Rect = { x = x, y = y, w = 100, h = 100 };
        SDL_RenderFillRect(renderer, *rect);

        SDL_RenderPresent(renderer);
    }

    return 0;
}